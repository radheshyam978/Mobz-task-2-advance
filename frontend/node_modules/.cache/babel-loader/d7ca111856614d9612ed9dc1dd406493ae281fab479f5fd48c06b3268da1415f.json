{"ast":null,"code":"import{useEffect,useMemo,useState}from'react';import{Link,useNavigate}from'react-router-dom';import api from'./Axios';import{socket}from'./Socket';import UserModal from'./UserModal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function LiveUsers(){const[users,setUsers]=useState([]);const[selectedUser,setSelectedUser]=useState(null);const[showModal,setShowModal]=useState(false);const navigate=useNavigate();const authUser=useMemo(()=>{try{return JSON.parse(sessionStorage.getItem('authUser')||'null');}catch(_unused){return null;}},[]);useEffect(()=>{function onConnect(){if(authUser!==null&&authUser!==void 0&&authUser.email){socket.emit('join_live_users',{email:authUser.email,firstName:authUser.firstName,lastName:authUser.lastName,loginId:authUser.loginId});}else{socket.emit('viewer_join');}}socket.connect();socket.on('connect',onConnect);socket.on('live_users_update',list=>setUsers(Array.isArray(list)?list:[]));return()=>{socket.off('connect',onConnect);socket.off('live_users_update');socket.disconnect();};},[authUser]);const logout=()=>{try{socket.emit('leave_live_users');}catch(_unused2){}sessionStorage.removeItem('authUser');navigate('/login');};const openUser=async email=>{try{const{data}=await api.get('/users',{params:{email}});const u=Array.isArray(data===null||data===void 0?void 0:data.user)?data.user[0]:data===null||data===void 0?void 0:data.user;setSelectedUser(u||null);setShowModal(true);}catch(e){alert('Error fetching user');}};return/*#__PURE__*/_jsx(\"div\",{className:\"bg-light min-vh-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container py-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"mb-3\",children:\"Live Users\"}),/*#__PURE__*/_jsx(\"div\",{children:authUser?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"span\",{id:\"me\",className:\"me-3 text-muted\",children:[\"You: \",authUser.firstName||'',\" \",authUser.lastName||'',\" <\",authUser.email||'',\">\"]}),/*#__PURE__*/_jsx(\"button\",{id:\"logoutBtn\",className:\"btn btn-outline-secondary btn-sm\",onClick:logout,children:\"Logout\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"me-3 text-muted\",children:\"You are viewing as a guest\"}),/*#__PURE__*/_jsx(Link,{to:\"/login\",className:\"btn btn-primary btn-sm\",children:\"Login\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"btn btn-link btn-sm\",children:\"Register\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-hover align-middle\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-dark\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Login ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[(!users||users.length===0)&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"3\",className:\"text-center\",children:\"No users connected.\"})}),users&&users.map(u=>/*#__PURE__*/_jsxs(\"tr\",{style:{cursor:\"pointer\"},onClick:()=>openUser(u.email),children:[/*#__PURE__*/_jsx(\"td\",{children:u.email}),/*#__PURE__*/_jsx(\"td\",{children:u.loginId||\"N/A\"}),/*#__PURE__*/_jsx(\"td\",{children:u.isOnline?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-success\",children:\"Online\"}):/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-danger\",children:\"Offline\"})})]},u.email))]})]})}),/*#__PURE__*/_jsx(UserModal,{user:selectedUser,show:showModal,onClose:()=>setShowModal(false)})]})});}","map":{"version":3,"names":["useEffect","useMemo","useState","Link","useNavigate","api","socket","UserModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LiveUsers","users","setUsers","selectedUser","setSelectedUser","showModal","setShowModal","navigate","authUser","JSON","parse","sessionStorage","getItem","_unused","onConnect","email","emit","firstName","lastName","loginId","connect","on","list","Array","isArray","off","disconnect","logout","_unused2","removeItem","openUser","data","get","params","u","user","e","alert","className","children","id","onClick","to","length","colSpan","map","style","cursor","isOnline","show","onClose"],"sources":["C:/Users/vaish/Downloads/Email_Mobile_OTP_Redis-main/Mobz-task-advance-2/frontend/src/Components/LiveUsers.jsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport api from './Axios';\nimport { socket } from './Socket';\nimport UserModal from './UserModal';\n\nexport default function LiveUsers() {\n  const [users, setUsers] = useState([]);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [showModal, setShowModal] = useState(false);\n  const navigate = useNavigate();\n\n  const authUser = useMemo(() => {\n    try {\n      return JSON.parse(sessionStorage.getItem('authUser') || 'null');\n    } catch {\n      return null;\n    }\n  }, []);\n\n  useEffect(() => {\n    function onConnect() {\n      if (authUser?.email) {\n        socket.emit('join_live_users', {\n          email: authUser.email,\n          firstName: authUser.firstName,\n          lastName: authUser.lastName,\n          loginId: authUser.loginId,\n        });\n      } else {\n        socket.emit('viewer_join');\n      }\n    }\n\n    socket.connect();\n    socket.on('connect', onConnect);\n    socket.on('live_users_update', (list) => setUsers(Array.isArray(list) ? list : []));\n\n    return () => {\n      socket.off('connect', onConnect);\n      socket.off('live_users_update');\n      socket.disconnect();\n    };\n  }, [authUser]);\n\n  const logout = () => {\n    try {\n      socket.emit('leave_live_users');\n    } catch {}\n    sessionStorage.removeItem('authUser');\n    navigate('/login');\n  };\n\n  const openUser = async (email) => {\n    try {\n      const { data } = await api.get('/users', { params: { email } });\n      const u = Array.isArray(data?.user) ? data.user[0] : data?.user;\n      setSelectedUser(u || null);\n      setShowModal(true);\n    } catch (e) {\n      alert('Error fetching user');\n    }\n  };\n\n  return (\n    <div className=\"bg-light min-vh-100\">\n      <div className=\"container py-4\">\n        <div className=\"d-flex align-items-center justify-content-between\">\n          <h3 className=\"mb-3\">Live Users</h3>\n          <div>\n            {authUser ? (\n              <>\n                <span id=\"me\" className=\"me-3 text-muted\">\n                  You: {authUser.firstName || ''} {authUser.lastName || ''} &lt;{authUser.email || ''}&gt;\n                </span>\n                <button\n                  id=\"logoutBtn\"\n                  className=\"btn btn-outline-secondary btn-sm\"\n                  onClick={logout}\n                >\n                  Logout\n                </button>\n              </>\n            ) : (\n              <>\n                <span className=\"me-3 text-muted\">You are viewing as a guest</span>\n                <Link to=\"/login\" className=\"btn btn-primary btn-sm\">Login</Link>\n                <Link to=\"/\" className=\"btn btn-link btn-sm\">Register</Link>\n              </>\n            )}\n          </div>\n        </div>\n\n        {/* Users Table */}\n        <div className=\"table-responsive\">\n          <table className=\"table table-hover align-middle\">\n            <thead className=\"table-dark\">\n              <tr>\n                <th>Email</th>\n                <th>Login ID</th>\n                <th>Status</th>\n              </tr>\n            </thead>\n            <tbody>\n              {(!users || users.length === 0) && (\n                <tr>\n                  <td colSpan=\"3\" className=\"text-center\">\n                    No users connected.\n                  </td>\n                </tr>\n              )}\n              {users && users.map((u) => (\n                <tr\n                  key={u.email}\n                  style={{ cursor: \"pointer\" }}\n                  onClick={() => openUser(u.email)}\n                >\n                  <td>{u.email}</td>\n                  <td>{u.loginId || \"N/A\"}</td>\n                  <td>\n                    {u.isOnline ? (\n                      <span className=\"badge bg-success\">Online</span>\n                    ) : (\n                      <span className=\"badge bg-danger\">Offline</span>\n                    )}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n\n        {/* User Modal */}\n        <UserModal\n          user={selectedUser}\n          show={showModal}\n          onClose={() => setShowModal(false)}\n        />\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}